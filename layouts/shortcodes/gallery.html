{{- $columns := .Get "columns" | default "3" -}}
{{- $gap := .Get "gap" | default "1rem" -}}
{{- $caption := .Get "caption" | default "" -}}

<div class="gallery" data-columns="{{ $columns }}" style="--gallery-gap: {{ $gap }};">
  {{- $images := split (.Inner | strings.TrimSpace) "\n" -}}
  {{- range $images -}}
    {{- $line := . | strings.TrimSpace -}}
    {{- if $line -}}
      {{- $parts := split $line "|" -}}
      {{- $src := index $parts 0 | strings.TrimSpace -}}
      {{- $alt := "" -}}
      {{- $imgCaption := "" -}}
      {{- if gt (len $parts) 1 -}}
        {{- $alt = index $parts 1 | strings.TrimSpace -}}
      {{- end -}}
      {{- if gt (len $parts) 2 -}}
        {{- $imgCaption = index $parts 2 | strings.TrimSpace -}}
      {{- end -}}
      <div class="gallery-item">
        <a href="{{ $src | relURL }}" class="gallery-link" data-lightbox="gallery">
          <img src="{{ $src | relURL }}" alt="{{ $alt }}" loading="lazy" />
          <div class="gallery-overlay">
            <span class="gallery-icon">âŠ•</span>
          </div>
        </a>
        {{- if $imgCaption -}}
          <div class="gallery-item-caption">{{ $imgCaption }}</div>
        {{- end -}}
      </div>
    {{- end -}}
  {{- end -}}
  {{- if $caption -}}
    <div class="gallery-caption">{{ $caption }}</div>
  {{- end -}}
</div>
